# Service Level Objectives (SLOs) for Pivotal Flow Reporting

## Overview

This document defines the Service Level Objectives (SLOs) for the Pivotal Flow reporting and export system. These SLOs ensure reliable, performant, and compliant reporting operations.

## SLO Definitions

### 1. Export Job Success Rate

**Objective**: 99.5% of export jobs should complete successfully

**Measurement**:
- **SLI**: `rate(pivotal_export_completed_total[5m]) / rate(pivotal_export_started_total[5m]) * 100`
- **Target**: ≥ 99.5%
- **Window**: 5-minute rolling average
- **Alert**: `ExportJobFailureRate` when < 99% for 5 minutes

**Calculation**:
```
Success Rate = (Completed Exports / Started Exports) × 100
```

**Business Impact**: 
- Failed exports impact user productivity
- May indicate data processing issues
- Affects compliance reporting capabilities

### 2. Export Job Completion Time

**Objective**: 95% of export jobs should complete within 2 minutes

**Measurement**:
- **SLI**: `histogram_quantile(0.95, rate(pivotal_export_duration_ms_bucket[5m])) / 1000`
- **Target**: ≤ 120 seconds (P95)
- **Window**: 5-minute rolling average
- **Alert**: `SlowExportJobs` when P95 > 120 seconds for 5 minutes

**Calculation**:
```
P95 Completion Time = 95th percentile of export job durations over 5 minutes
```

**Business Impact**:
- Slow exports affect user experience
- May indicate performance bottlenecks
- Could lead to user abandonment

### 3. Report Generation Latency

**Objective**: 95% of report summaries should generate within 250ms

**Measurement**:
- **SLI**: `histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{route="/v1/reports/summary/*"}[5m])) * 1000`
- **Target**: ≤ 250ms (P95)
- **Window**: 5-minute rolling average
- **Alert**: `SlowReportGeneration` when P95 > 250ms for 5 minutes

**Calculation**:
```
P95 Latency = 95th percentile of report generation times over 5 minutes
```

**Business Impact**:
- Slow report generation affects dashboard performance
- May indicate database query optimization needs
- Affects real-time decision making

### 4. Export Job Queue Health

**Objective**: Export job queue should process jobs within 30 seconds of creation

**Measurement**:
- **SLI**: `histogram_quantile(0.95, rate(pivotal_export_duration_ms_bucket{status="processing"}[5m])) / 1000`
- **Target**: ≤ 30 seconds (P95)
- **Window**: 5-minute rolling average
- **Alert**: `ExportQueueBacklog` when P95 > 30 seconds for 5 minutes

**Calculation**:
```
Queue Processing Time = Time from job creation to processing start
```

**Business Impact**:
- Queue backlogs indicate system overload
- May require scaling of background workers
- Affects user experience for large exports

### 5. Data Accuracy

**Objective**: 100% of exported data should be accurate (no data corruption)

**Measurement**:
- **SLI**: `rate(pivotal_export_data_validation_errors_total[5m])`
- **Target**: 0 errors
- **Window**: 5-minute rolling average
- **Alert**: `DataValidationErrors` when > 0 errors for 1 minute

**Calculation**:
```
Data Accuracy = (Valid Exports / Total Exports) × 100
```

**Business Impact**:
- Data corruption affects compliance
- May lead to incorrect business decisions
- Requires immediate investigation and remediation

## Additional Metrics

### 6. Export Volume Monitoring
- **Metric**: `pivotal_export_started_total`
- **Purpose**: Monitor export demand patterns
- **Alert**: `HighExportVolume` when rate > 100 exports/minute

### 7. Report Type Distribution
- **Metric**: `pivotal_export_started_total` by `report_type`
- **Purpose**: Understand which reports are most popular
- **Alert**: `UnusualReportType` when any type > 50% of total exports

### 8. Export Format Preferences
- **Metric**: `pivotal_export_started_total` by `format`
- **Purpose**: Monitor user format preferences
- **Alert**: `FormatShift` when format distribution changes > 20%

## Alerting Rules

```yaml
groups:
  - name: pivotal-flow-reporting-alerts
    rules:
      - alert: ExportJobFailureRate
        expr: rate(pivotal_export_completed_total[5m]) / rate(pivotal_export_started_total[5m]) * 100 < 99
        for: 5m
        labels:
          severity: warning
          service: reporting
        annotations:
          summary: "Export job failure rate is high"
          description: "Export job success rate is {{ $value }}% over 5 minutes (threshold: 99%)"

      - alert: SlowExportJobs
        expr: histogram_quantile(0.95, rate(pivotal_export_duration_ms_bucket[5m])) / 1000 > 120
        for: 5m
        labels:
          severity: warning
          service: reporting
        annotations:
          summary: "Export jobs are taking too long"
          description: "P95 export completion time is {{ $value }}s over 5 minutes (threshold: 120s)"

      - alert: SlowReportGeneration
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{route="/v1/reports/summary/*"}[5m])) * 1000 > 250
        for: 5m
        labels:
          severity: warning
          service: reporting
        annotations:
          summary: "Report generation is slow"
          description: "P95 report generation time is {{ $value }}ms over 5 minutes (threshold: 250ms)"

      - alert: ExportQueueBacklog
        expr: histogram_quantile(0.95, rate(pivotal_export_duration_ms_bucket{status="processing"}[5m])) / 1000 > 30
        for: 5m
        labels:
          severity: warning
          service: reporting
        annotations:
          summary: "Export queue has backlog"
          description: "P95 queue processing time is {{ $value }}s over 5 minutes (threshold: 30s)"

      - alert: DataValidationErrors
        expr: rate(pivotal_export_data_validation_errors_total[5m]) > 0
        for: 1m
        labels:
          severity: critical
          service: reporting
        annotations:
          summary: "Data validation errors detected"
          description: "Export data validation errors detected - immediate investigation required"
```

## Error Budget

- **Monthly Error Budget**: 0.5% (99.5% success rate target)
- **Reporting Period**: Calendar month
- **Burn Rate**: 0.5% per month
- **Consequence**: If error budget is exhausted, freeze new feature deployments until budget is restored

## Compliance Requirements

### Data Retention
- Export job metadata: 7 days
- Export files: 30 days (configurable per organization)
- Audit logs: 7 years (for compliance reporting)

### Security
- All exports must be scoped to user's organization
- Export files must be encrypted at rest
- Access logs must be maintained for all export operations

### Performance Targets
- Export 10,000 rows: < 2 minutes
- Report summary generation: < 250ms
- Export job queue processing: < 30 seconds

## Monitoring Dashboard

Key metrics to monitor:
1. Export job success rate (99.5% target)
2. Export completion time (P95 < 2 minutes)
3. Report generation latency (P95 < 250ms)
4. Queue processing time (P95 < 30 seconds)
5. Data validation errors (0 target)
6. Export volume trends
7. Report type distribution
8. Format preferences

## Runbooks

- [rb-04-export-failures.md](../runbooks/rb-04-export-failures.md)
- [rb-05-slow-reports.md](../runbooks/rb-05-slow-reports.md)
- [rb-06-data-validation.md](../runbooks/rb-06-data-validation.md)
